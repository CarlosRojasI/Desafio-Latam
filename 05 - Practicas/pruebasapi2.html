<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Static Template</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <button class="btn btn-info" id="consulta">Consultar otro usuario</button>
    <div class="container text-center">
      <div class="card" style="width: 18rem;">
        <img
          src="https://www.americanaircraftsales.com/wp-content/uploads/2016/09/no-profile-img.jpg"
          class="card-img-top"
          id="fotoPerfil"
        />
        <div class="card-body">
          <h5 class="card-title" id="Nombre">Nombre</h5>
          <p class="card-text" id="email">email</p>
          <p class="card-text" id="edad">Edad</p>
          <button class="btn btn-primary" id="agregar" onclick="agregar()">
            Agregar a la tabla
          </button>
        </div>
      </div>
    </div>
    <table class="table">
      <thead>
        <th>id</th>
        <th>Foto</th>
        <th>Email</th>
        <th>Edad</th>
        <th>Nombre</th>
        <th></th>
      </thead>
      <tbody id="registros"></tbody>
    </table>

    <script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"
    ></script>
    <script>
      let registros = [];
      let persona = {};
      $("#consulta").click(function () {
        $.ajax({
          url: "https://randomuser.me/api/",

          success: function (data) {
            let title = data.results[0].name.title;
            let first = data.results[0].name.first;
            let last = data.results[0].name.last;
            let mail = data.results[0].email;
            let edad = data.results[0].dob.age;
            let foto = data.results[0].picture.large;

            persona.nombre = `${title} ${first} ${last}`;
            persona.edad = edad;
            persona.foto = foto;
            persona.mail = mail;

            $("#Nombre").html(`${title} ${first} ${last}`);
            $("#email").html(`${mail}`);
            $("#edad").html(`${edad}`);
            $("#fotoPerfil").attr("src", foto);
          }
        });
      });

      function agregar() {
        if (persona.mail) {
          if (registros.find((r) => r.mail == persona.mail)) {
            alert("Ya existe una persona con este correo");
          } else {
            registros.push(persona);
            llenarHtml();
          }
        } else {
          alert("Debe de consultar un usuario");
        }
      }

      function llenarHtml() {
        $("#registros").html("");
        registros.forEach((e, i) => {
          $("#registros").append(`
                <tr>
                    <td>${i + 1}</td>
                    <td><img width="70" src="${e.foto}"></td>
                    <td>${e.mail}</td>
                    <td>${e.edad}</td>
                    <td>${e.nombre}</td>
                    <td><button class="btn btn-danger" onclick="eliminar(${i})">Eliminar</button></td>
                </tr>
      `);
        });
      }

      function eliminar(i) {
        registros.splice(i, 1);
        llenarHtml();
      }
    </script>
  </body>
</html>
